_FRAME_1_16x15 = bytes(
    [
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0xFD,
        0xFD,
        0xFD,
        0xFD,
        0xFD,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0xFD,
        0xFD,
        0x00,
        0xFD,
        0x00,
        0x00,
        0x00,
        0xFD,
        0xFD,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0xFD,
        0x00,
        0x00,
        0xFD,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0xFD,
        0x00,
        0x00,
        0x00,
        0x00,
        0xFD,
        0xFD,
        0x00,
        0x00,
        0x00,
        0xFD,
        0x00,
        0x00,
        0x00,
        0xFD,
        0xFD,
        0xFD,
        0xFD,
        0x00,
        0x00,
        0x00,
        0xFD,
        0xFD,
        0xFD,
        0xFD,
        0x00,
        0xFD,
        0x00,
        0x00,
        0x00,
        0xFD,
        0xFD,
        0xFD,
        0xFD,
        0x00,
        0x00,
        0xFD,
        0xFD,
        0xFD,
        0xFD,
        0xFD,
        0xFD,
        0xFD,
        0x00,
        0x00,
        0xFD,
        0xFD,
        0xFD,
        0xFD,
        0xFD,
        0xFD,
        0x00,
        0xFD,
        0x00,
        0xFD,
        0xFD,
        0xFD,
        0xFD,
        0xFD,
        0xFD,
        0xFD,
        0xFD,
        0xFD,
        0xFD,
        0xFD,
        0xFD,
        0xFD,
        0x00,
        0xFD,
        0x00,
        0xFD,
        0xFD,
        0xFD,
        0xFD,
        0xFD,
        0xFD,
        0xFD,
        0xFD,
        0xFD,
        0x00,
        0xFD,
        0xFD,
        0xFD,
        0x00,
        0xFD,
        0xFD,
        0xFD,
        0x00,
        0xFD,
        0xFD,
        0xFD,
        0xFD,
        0xFD,
        0xFD,
        0x00,
        0x00,
        0x00,
        0xFD,
        0xFD,
        0x00,
        0xFD,
        0xFD,
        0xFD,
        0x00,
        0x00,
        0xFD,
        0xFD,
        0xFD,
        0xFD,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0xFD,
        0x00,
        0x00,
        0xFD,
        0x00,
        0x00,
        0x00,
        0x00,
        0xFD,
        0xFD,
        0xFD,
        0x00,
        0x00,
        0x00,
        0x00,
        0xFD,
        0x00,
        0x00,
        0x00,
        0xFD,
        0x00,
        0x00,
        0x00,
        0x00,
        0xFD,
        0xFD,
        0xFD,
        0x00,
        0x00,
        0xFD,
        0xFD,
        0xFD,
        0x00,
        0x00,
        0x00,
        0x00,
        0xFD,
        0xFD,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0xFD,
        0xFD,
        0xFD,
        0xFD,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0xFD,
        0xFD,
        0x00,
        0x00,
        0xFD,
        0xFD,
        0xFD,
        0xFD,
        0xFD,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0xFD,
        0xFD,
        0xFD,
        0xFD,
        0xFD,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
    ]
)
_FRAME_2_16x15 = bytes(
    [
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x1B,
        0x1B,
        0x1B,
        0x1B,
        0x1B,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x1B,
        0x1B,
        0x1B,
        0x1B,
        0x1B,
        0x00,
        0x00,
        0x1B,
        0x1B,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x1B,
        0x1B,
        0x1B,
        0x1B,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x1B,
        0x1B,
        0x00,
        0x00,
        0x00,
        0x00,
        0x1B,
        0x1B,
        0x1B,
        0x00,
        0x00,
        0x1B,
        0x1B,
        0x1B,
        0x00,
        0x00,
        0x00,
        0x00,
        0x1B,
        0x00,
        0x00,
        0x00,
        0x1B,
        0x00,
        0x00,
        0x00,
        0x00,
        0x1B,
        0x1B,
        0x1B,
        0x00,
        0x00,
        0x00,
        0x00,
        0x1B,
        0x00,
        0x00,
        0x1B,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x1B,
        0x1B,
        0x1B,
        0x1B,
        0x00,
        0x00,
        0x1B,
        0x1B,
        0x1B,
        0x00,
        0x1B,
        0x1B,
        0x00,
        0x00,
        0x00,
        0x1B,
        0x1B,
        0x1B,
        0x1B,
        0x1B,
        0x1B,
        0x00,
        0x1B,
        0x1B,
        0x1B,
        0x00,
        0x1B,
        0x1B,
        0x1B,
        0x00,
        0x1B,
        0x1B,
        0x1B,
        0x1B,
        0x1B,
        0x1B,
        0x1B,
        0x1B,
        0x1B,
        0x00,
        0x1B,
        0x00,
        0x1B,
        0x1B,
        0x1B,
        0x1B,
        0x1B,
        0x1B,
        0x1B,
        0x1B,
        0x1B,
        0x1B,
        0x1B,
        0x1B,
        0x1B,
        0x00,
        0x1B,
        0x00,
        0x1B,
        0x1B,
        0x1B,
        0x1B,
        0x1B,
        0x1B,
        0x00,
        0x00,
        0x1B,
        0x1B,
        0x1B,
        0x1B,
        0x1B,
        0x1B,
        0x1B,
        0x00,
        0x00,
        0x1B,
        0x1B,
        0x1B,
        0x1B,
        0x00,
        0x00,
        0x00,
        0x1B,
        0x00,
        0x1B,
        0x1B,
        0x1B,
        0x1B,
        0x00,
        0x00,
        0x00,
        0x1B,
        0x1B,
        0x1B,
        0x1B,
        0x00,
        0x00,
        0x00,
        0x1B,
        0x00,
        0x00,
        0x00,
        0x1B,
        0x1B,
        0x00,
        0x00,
        0x00,
        0x00,
        0x1B,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x1B,
        0x00,
        0x00,
        0x1B,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x1B,
        0x1B,
        0x00,
        0x00,
        0x00,
        0x1B,
        0x00,
        0x1B,
        0x1B,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x1B,
        0x1B,
        0x1B,
        0x1B,
        0x1B,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
    ]
)

_FRAME_3_16x15 = bytes(
    [
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0xF0,
        0xF0,
        0xF0,
        0xF0,
        0xF0,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0xF0,
        0xF0,
        0xF0,
        0xF0,
        0xF0,
        0x00,
        0x00,
        0xF0,
        0xF0,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0xF0,
        0xF0,
        0xF0,
        0xF0,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0xF0,
        0xF0,
        0x00,
        0x00,
        0x00,
        0x00,
        0xF0,
        0xF0,
        0xF0,
        0x00,
        0x00,
        0xF0,
        0xF0,
        0xF0,
        0x00,
        0x00,
        0x00,
        0x00,
        0xF0,
        0x00,
        0x00,
        0x00,
        0xF0,
        0x00,
        0x00,
        0x00,
        0x00,
        0xF0,
        0xF0,
        0xF0,
        0x00,
        0x00,
        0x00,
        0x00,
        0xF0,
        0x00,
        0x00,
        0xF0,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0xF0,
        0xF0,
        0xF0,
        0xF0,
        0x00,
        0x00,
        0xF0,
        0xF0,
        0xF0,
        0x00,
        0xF0,
        0xF0,
        0x00,
        0x00,
        0x00,
        0xF0,
        0xF0,
        0xF0,
        0xF0,
        0xF0,
        0xF0,
        0x00,
        0xF0,
        0xF0,
        0xF0,
        0x00,
        0xF0,
        0xF0,
        0xF0,
        0x00,
        0xF0,
        0xF0,
        0xF0,
        0xF0,
        0xF0,
        0xF0,
        0xF0,
        0xF0,
        0xF0,
        0x00,
        0xF0,
        0x00,
        0xF0,
        0xF0,
        0xF0,
        0xF0,
        0xF0,
        0xF0,
        0xF0,
        0xF0,
        0xF0,
        0xF0,
        0xF0,
        0xF0,
        0xF0,
        0x00,
        0xF0,
        0x00,
        0xF0,
        0xF0,
        0xF0,
        0xF0,
        0xF0,
        0xF0,
        0x00,
        0x00,
        0xF0,
        0xF0,
        0xF0,
        0xF0,
        0xF0,
        0xF0,
        0xF0,
        0x00,
        0x00,
        0xF0,
        0xF0,
        0xF0,
        0xF0,
        0x00,
        0x00,
        0x00,
        0xF0,
        0x00,
        0xF0,
        0xF0,
        0xF0,
        0xF0,
        0x00,
        0x00,
        0x00,
        0xF0,
        0xF0,
        0xF0,
        0xF0,
        0x00,
        0x00,
        0x00,
        0xF0,
        0x00,
        0x00,
        0x00,
        0xF0,
        0xF0,
        0x00,
        0x00,
        0x00,
        0x00,
        0xF0,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0xF0,
        0x00,
        0x00,
        0xF0,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0xF0,
        0xF0,
        0x00,
        0x00,
        0x00,
        0xF0,
        0x00,
        0xF0,
        0xF0,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
        0xF0,
        0xF0,
        0xF0,
        0xF0,
        0xF0,
        0x00,
        0x00,
        0x00,
        0x00,
        0x00,
    ]
)

_desktop = None
_desktop_frame = 0
_frame_counter = 0


def start(view_manager) -> bool:
    """Start the loading animation."""
    from picoware.gui.desktop import Desktop

    global _desktop
    if _desktop is None:
        _desktop = Desktop(view_manager.draw)
    return True


def run(view_manager) -> None:
    """Animate the loading spinner."""
    from picoware.system.buttons import BUTTON_LEFT, BUTTON_CENTER, BUTTON_UP
    from picoware.system.view import View
    from picoware.system.vector import Vector

    global _desktop
    global _desktop_frame
    global _frame_counter
    if _desktop:
        _desktop.draw(
            (
                _FRAME_1_16x15
                if _desktop_frame == 0
                else (_FRAME_2_16x15 if _desktop_frame == 1 else _FRAME_3_16x15)
            ),
            Vector(16, 15),
            Vector(150, 150),
        )
        _frame_counter += 1
        if _frame_counter % 10 == 0:
            _desktop_frame = (_desktop_frame + 1) % 3

    input_manager = view_manager.input_manager
    button: int = input_manager.get_last_button()

    if button == BUTTON_LEFT:
        from picoware.applications.system import system_info

        input_manager.reset(True)
        view_manager.add(
            View("system_info", system_info.run, system_info.start, system_info.stop)
        )
        view_manager.switch_to("system_info")
    elif button in (BUTTON_CENTER, BUTTON_UP):
        from picoware.applications import library

        input_manager.reset(True)
        view_manager.add(View("library", library.run, library.start, library.stop))
        view_manager.switch_to("library")


def stop(view_manager) -> None:
    """Stop the loading animation."""
    from gc import collect

    global _desktop
    global _desktop_frame
    global _frame_counter
    if _desktop:
        del _desktop
        _desktop = None
    _desktop_frame = 0
    _frame_counter = 0
    collect()
